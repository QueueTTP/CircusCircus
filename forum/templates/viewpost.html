
{% extends 'layout.html' %}
{% block body %}
{{ path|safe}}

<div class="actualpost">
	<div class="actualposttitle">
		<a href="/viewpost?post={{ post.id }}">{{post.title}}</a>
		<div class="postposter" {% if post.user.admin %} style="color: red;" {% endif %}>
			{{ post.user.username }}

		</div>
		<div class="posttime">
			{{ post.get_time_string() }}
		</div>
	</div>
	<div class="postcontent">
		{{post.content}}
	</div>

</div>
<!-- Add Likies/Dislikes display here-->
<!--  -->
<!-- Added likes and dislike buttons here -Peter -->
<div class="postlikes">
    <button onclick="likePost('{{ post.id }}')">👍 Like (<span id="like-count">{{ post.like_count }}</span>)</button>
    <button onclick="dislikePost('{{ post.id }}')">👎 Dislike (<span id="dislike-count">{{ post.dislike_count }}</span>)</button>
</div>
<!-- end likes disklikes div -->

<div class="addcomment" id="addcomment">
	<form action="/action_comment?post={{ post.id }}" method="POST">
		<textarea class="inputbox varwidth" rows="6" name="content"></textarea><br>
		<input class="inputbox" style="margin-bottom: 1%;" type="submit" value="Comment">
	</form>
</div>
<div style="text-align: center;">

	

	{% if current_user.is_authenticated %}
	<input type="button" id="displayaddcomment" onclick="toggle()" value="Add a comment">

	{% else %}
	<a href="/loginform">Login or register to make a comment</a>
	{% endif %}
</div>
{%if comments%}
<div class="comments">
{% for comment in comments %}
	
	<div class="comment">
		<div class="commentuser">
			(<span  {% if comment.user.admin %} style="color: red;" {% endif %}>{{ comment.user.username }}</span>) - 
		</div>
		<div class="commentcontent">
			{{ comment.content }}
		</div>
		
		<div class="commenttime">
			{{ comment.get_time_string() }}
		</div>
	</div>
	<br>
	
{% endfor %}
</div>
{% endif %}
<script type="text/javascript">
function toggle(){
	var div = document.getElementById("addcomment");
	var button = document.getElementById("displayaddcomment")
	if(div.style.display == "none" || div.style.display.trim() == ""){
		div.style.display = "inline";
		button.value="Hide";
	}else{
		div.style.display = "none";
		button.value="Add a comment"
	}
	
}
// Added javascript to display likes and dislies -Peter
function likePost(postId) {
    console.log("Liking post with ID:", postId); // Debug log
    fetch(`/like_post/${postId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        console.log("Response:", response); // Debug log
        return response.json();
    })
    .then(data => {
        console.log("Data:", data); // Debug log
        if (data.success) {
            document.getElementById('like-count').innerText = data.like_count;
        } else {
            alert('Error: ' + data.message);
        }
    })
    .catch(error => console.error('Error:', error));
}

function dislikePost(postId) {
    fetch(`/dislike_post/${postId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById('dislike-count').innerText = data.dislike_count;
        } else {
            alert('Error: ' + data.message);
        }
    })
    .catch(error => console.error('Error:', error));
}
</script>


{% endblock %}


